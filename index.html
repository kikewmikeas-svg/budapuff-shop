<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BudaPuff Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background:#1c1c1c;
  color:white;
  font-family:sans-serif;
  padding:15px;
  margin:0;
}

h2 { margin-top:0; }


.card {
  background: linear-gradient(145deg, #8b0000, #5a0000);
  padding: 25px;
  border-radius: 22px;
  text-align: center;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transition: 0.2s;
}

.card:active { transform: scale(0.97); }

}
  /* ===== –ö–ê–¢–ï–ì–û–†–ò–ò ===== */

.grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 22px;   /* –±—ã–ª–æ 16px ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º */
    padding: 16px;
}

.category-card{
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  cursor: pointer;
  height: 160px;
  display: flex;
  align-items: flex-end;
  padding: 20px;
  color: white;
  font-weight: bold;
  font-size: 18px;
  background-size: cover;
  background-position: center;
  background-blend-mode: darken;
background-color: rgba(0,0,0,0.4);
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  margin-bottom: 20px;
}

.category-card:active{
  transform:scale(0.96);
}

.category-title{
  font-weight:bold;
  font-size:15px;
}

.product-card img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:15px;
  margin-bottom:10px;
}

.qty-control{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin-top:10px;
}

.qty-control button{
  width:35px;
  height:35px;
  border-radius:8px;
  border:none;
  background:#ff2d55;
  color:white;
  font-size:18px;
}

button {
  background:#ff2d55;
  border:none;
  padding:8px 12px;
  color:white;
  border-radius:10px;
  margin-top:8px;
  cursor:pointer;
}


#cartBar{
   position:fixed;
   bottom:0;
   left:0;
   right:0;
   background:#111;
   padding:15px;
   display:none;
   justify-content:space-between;
   align-items:center;
   box-shadow:0 -5px 20px rgba(0,0,0,0.6);
}

/* ===== –ê–ù–ò–ú–ê–¶–ò–Ø –≠–ö–†–ê–ù–û–í ===== */

.screen {
  opacity: 0;
  transform: translateX(20px);
  transition: 0.3s ease;
}

.screen.show {
  opacity: 1;
  transform: translateX(0);
}

.fade-out {
  opacity: 0;
  transform: translateX(-20px);
  transition: 0.2s ease;
}
  /* === –ê–ù–ò–ú–ê–¶–ò–Ø –ö–ù–û–ü–û–ö +/- === */

.qty-btn {
  transition: transform 0.1s ease, background 0.2s ease;
}

.qty-btn:active {
  transform: scale(0.85);
}

.qty-number {
  display: inline-block;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.qty-number.bump {
    animation: qtyPop 0.3s ease;
}

@keyframes qtyPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); }
    100% { transform: scale(1); }
}
  /* –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ */
.product-card {
  transform: translateY(20px);
  opacity: 0;
}

.product-card.show {
  animation: fadeUp 0.4s ease forwards;
}

@keyframes fadeUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
  #topBar {
    position: fixed;
    top: 10px;
    right: 20px;
    z-index: 1000;
}

#topBar.show {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

#cartIcon {
    background: #ff3b5c;
    color: white;
    padding: 8px 14px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

#cartCount {
    background: white;
    color: #ff3b5c;
    padding: 2px 8px;
    border-radius: 50%;
    font-size: 14px;
}
  #cartIcon {
    background: #ff3b5c;
    color: white;
    padding: 8px 14px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.3s ease; /* –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é */
}

#cartIcon.bump {
    transform: scale(1.1); /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É */
}
  #cartCount {
    background: white;
    color: #ff3b5c;
    padding: 2px 8px;
    border-radius: 50%;
    font-size: 14px;
    font-weight: bold;
    display: inline-block;
    transition: transform 0.2s ease, opacity 0.2s ease; /* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
}

#cartCount.bump {
    transform: scale(1.3); /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ */
    opacity: 0.6; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
}
  #orderSuccess {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: #1e1e1e;
    color: white;
    padding: 14px 22px;
    border-radius: 14px;
    font-weight: bold;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 2000;
}

#orderSuccess.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}
  .top-menu {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.top-menu button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 12px;
    background: #2a2a2a;
    color: white;
    cursor: pointer;
}

.info-card {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 15px;
    line-height: 1.6;
}
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.delivery-card,
.payment-card {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 18px;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    transition: 0.3s;
}

.delivery-card:hover,
.payment-card:hover {
    transform: translateY(-5px);
}

.highlight {
    border: 2px solid #ff9800;
}

.badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ff9800;
    padding: 5px 10px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: bold;
}
  .add-btn {
    background: #ff4d6d;
    border: none;
    padding: 10px;
    border-radius: 12px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
}

.qty-control {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #2a2a2a;
    padding: 8px;
    border-radius: 12px;
}

.qty-btn {
    background: #ff4d6d;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 8px;
    color: white;
    font-size: 18px;
    cursor: pointer;
}

.continue-btn {
    flex: 1;
    background: #ff4d6d;
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 600;
}

.mini-qty {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #1c1c1c;
    padding: 8px 12px;
    border-radius: 12px;
}

.mini-qty button {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 8px;
    background: #ff4d6d;
    color: white;
    font-size: 18px;
    cursor: pointer;
}

.mini-qty span {
    min-width: 40px;
    text-align: center;
}
  /* ===== –¶–ï–ù–ê ===== */

.price-box {
    font-size: 28px;
    font-weight: 700;
    color: #ff4d6d;
    margin: 15px 0 25px 0;
}

.price-box span {
    font-size: 18px;
    opacity: 0.7;
    margin-left: 4px;
}

/* ===== –ö–ù–û–ü–ö–ê "–ü–†–û–î–û–õ–ñ–ò–¢–¨" ===== */

.continue-btn {
    flex: 1;

    background: #ff4d6d;
    border: none;
    border-radius: 14px;

    color: white;
    font-size: 16px;
    font-weight: 600;

    cursor: pointer;
    transition: transform 0.15s ease;
}

.continue-btn:active {
    transform: scale(0.96);
}


/* ===== –ú–ò–ù–ò –ë–õ–û–ö +/- ===== */

.mini-qty {
    display: flex;
    align-items: center;
    gap: 12px;

    background: #1c1c1c;
    padding: 8px 14px;

    border-radius: 14px;
}

.mini-qty button {
    width: 32px;
    height: 32px;

    border: none;
    border-radius: 8px;

    background: #ff4d6d;
    color: white;

    font-size: 18px;
    font-weight: 600;

    cursor: pointer;
    transition: transform 0.15s ease;
}

.mini-qty button:active {
    transform: scale(0.9);
}

.mini-qty span {
    min-width: 45px;
    text-align: center;

    font-size: 15px;
    font-weight: 500;
}
  /* ===== –ë–õ–û–ö –í–ù–ò–ó–£ –ö–ê–†–¢–û–ß–ö–ò ===== */

.bottom-bar {
    display: flex;
    gap: 12px;
    margin-top: 25px;
}

/* –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å */
.continue-btn {
    flex: 1;
    background: #ff4d6d;
    border: none;
    border-radius: 14px;
    color: white;
    font-size: 16px;
    font-weight: 600;
    height: 48px;
    cursor: pointer;
    transition: transform 0.15s ease;
}

.continue-btn:active {
    transform: scale(0.96);
}

/* –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π –º–∏–Ω–∏ +/- */
.mini-qty {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #2a2a2a;
    padding: 6px 12px;
    border-radius: 14px;
}

.mini-qty button {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 8px;
    background: #ff4d6d;
    color: white;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.15s ease;
}

.mini-qty button:active {
    transform: scale(0.9);
}

.mini-qty span {
    min-width: 40px;
    text-align: center;
    font-size: 14px;
    font-weight: 500;
}
 /* ===== NEW ACTION AREA ===== */

.action-area {
    position: relative;
    margin-top: 8px;
    padding: 10px 14px 14px 14px;
}

.add-btn {
    height: 40px;  
    font-size: 14px;
}

.qty-control {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 6px;
    backdrop-filter: blur(8px);
    margin-top: 0;   /* ‚Üê –í–ê–ñ–ù–û */
}
  /* ===== QTY BUTTON STYLE ===== */

.qty-btn {
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 8px;

    background: linear-gradient(135deg, #ff4d6d, #ff1e4d);
    color: white;

    font-size: 15px;
    font-weight: 600;

    display: flex;
    align-items: center;
    justify-content: center;

    cursor: pointer;
    transition: all 0.15s ease;
}

.qty-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(255, 77, 109, 0.4);
}

.qty-btn:active {
    transform: scale(0.9);
}

.qty-number {
    flex: 1;
    text-align: center;

    font-size: 13px;
    font-weight: 600;

    letter-spacing: 0.3px;
}
 /* ===== –ö–†–ê–°–ù–ê–Ø –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î ===== */

#backBtn {
  background: linear-gradient(135deg, #ff4d6d, #ff355d);
  border: none;
  padding: 6px 14px;
  border-radius: 20px;
  color: white;
  font-size: 13px;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  transition: all 0.15s ease;

  margin-bottom: 16px;
  box-shadow: 0 6px 16px rgba(255, 77, 109, 0.35);
}

#backBtn:active {
  transform: scale(0.93);
  box-shadow: 0 3px 10px rgba(255, 77, 109, 0.25);
}
  .product-image-box {
    background: #1c1c1e;
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.product-image-box img {
    max-width: 100%;
    max-height: 260px;
    object-fit: contain;
}
  .price-box {
    background: linear-gradient(145deg, #1c1c1e, #111);
    padding: 16px 20px;
    border-radius: 16px;
    font-size: 24px;
    font-weight: 700;
    color: #ff4d6d;
    margin-top: 10px;
    display: inline-block;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
}

.price-box span {
    font-size: 16px;
    opacity: 0.8;
}
  .product-desc {
    opacity: 0.8;
    margin: 12px 0 18px 0;
    line-height: 1.5;
}
  .product-details {
    padding-bottom: 140px;
}
  /* ===== –ö–û–†–ó–ò–ù–ê ===== */

.cart-item {
    background: #1c1c1e;
    padding: 16px;
    border-radius: 16px;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.cart-item-info strong {
    font-size: 16px;
    display: block;
    margin-bottom: 6px;
}

.cart-item-price {
    color: #ff4d6d;
    font-weight: 600;
}

.cart-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.cart-controls span {
    min-width: 24px;
    text-align: center;
    font-weight: 600;
}

.cart-controls button {
    background: #ff4d6d;
    border: none;
    color: white;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.15s ease;
}

.cart-controls button:active {
    transform: scale(0.9);
    opacity: 0.8;
}

.remove-btn {
    background: #2a2a2d !important;
    color: #ff4d6d !important;
}
 .cart-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.cart-controls button {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 10px;
    background: #ff4d6d;
    color: white;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
}

.cart-controls button:active {
    transform: scale(0.9);
}

.remove-btn {
    background: #2a2a2a;
} 
  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
}

.cart-item-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.cart-item-info strong {
    font-size: 16px;
}

.cart-item-price {
    color: #ff4d6d;
    font-weight: 600;
}

.cart-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.cart-controls button {
    width: 34px;
    height: 34px;
    border: none;
    border-radius: 8px;
    background: #ff4d6d;
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
}

.cart-controls button:active {
    transform: scale(0.85);
}

.remove-btn {
    background: #1c1c1e;
}

.cart-total {
    font-size: 18px;
    font-weight: 600;
    margin-top: 16px;
}
  /* ===== TOP MENU ===== */

.top-menu {
    display: flex;
    gap: 12px;
    margin-bottom: 30px;
}

.top-menu button {
    flex: 1;
    padding: 14px 0;
    border-radius: 14px;
    font-size: 15px;
    font-weight: 600;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    color: #fff;
    backdrop-filter: blur(10px);
    transition: all 0.25s ease;
    letter-spacing: 0.3px;
}

.top-menu button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 77, 109, 0.25);
    border-color: #ff4d6d;
}

.top-menu button:active {
    transform: scale(0.96);
}

/* –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ */
.top-menu .active {
    background: linear-gradient(135deg, #ff4d6d, #ff1e4d);
    border: none;
    box-shadow: 0 6px 18px rgba(255, 77, 109, 0.4);
}
  /* ===== SECTION TITLE ===== */

.section-title {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 18px;
    position: relative;
    display: inline-block;
}

.section-title::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -6px;
    width: 60%;
    height: 3px;
    border-radius: 10px;
    background: linear-gradient(90deg, #ff4d6d, transparent);
}
  /* ===== CATEGORY PRICE ===== */

.category-price {
    display: inline-block;
    margin-top: 6px;
    padding: 6px 12px;
    background: linear-gradient(135deg, #ff4d6d, #ff1e4d);
    border-radius: 10px;
    font-weight: 700;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(255, 77, 109, 0.3);
}
  /* ===== CATEGORY TITLE ===== */

.category-title {
    font-size: 18px;
    font-weight: 600;
    margin-top: 14px;
    margin-bottom: 4px;
    letter-spacing: 0.3px;
}
  .category-content {
    padding: 12px 14px 8px 14px;
}
  /* ===== PRODUCT CARD UPGRADE ===== */

.product-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 18px;
    overflow: hidden;
    transition: all 0.25s ease;
    position: relative;

    display: flex;
    flex-direction: column;
}
  
.product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    border-color: rgba(255,77,109,0.4);
}

.product-card img {
    height: 140px;
    object-fit: cover;
    border-radius: 14px;
}
  /* ===== PREMIUM CART SUMMARY ===== */

.cart-summary {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;

    background: rgba(18,18,18,0.96);
    backdrop-filter: blur(18px);

    padding: 16px 18px 26px 18px;

    border-radius: 22px 22px 0 0;
    border-top: 1px solid rgba(255,255,255,0.06);

    box-shadow: 0 -15px 40px rgba(0,0,0,0.7);

    z-index: 1000;
}

.sheet-handle {
    width: 42px;
    height: 5px;
    border-radius: 10px;
    background: rgba(255,255,255,0.25);
    margin: 0 auto 14px auto;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
}

.summary-label {
    font-size: 13px;
    opacity: 0.6;
}

.summary-price {
    font-size: 22px;
    font-weight: 700;
    color: #ff4d6d;
}

.summary-btn {
    width: 100%;
    height: 50px;

    border: none;
    border-radius: 16px;

    background: linear-gradient(135deg, #ff4d6d, #ff1e4d);
    color: white;

    font-size: 16px;
    font-weight: 600;

    cursor: pointer;
    transition: transform 0.15s ease;
}

.summary-btn:active {
    transform: scale(0.96);
}
  #main {
    padding-bottom: 160px;
}
 
.add-btn {
    width: 100%;
    height: 42px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, #ff4d6d, #ff1e4d);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.15s ease;
}

.add-btn:active {
    transform: scale(0.95);
  box-shadow: 0 6px 18px rgba(255,77,109,0.4);
}

.qty-control {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #2a2a2a;
    border-radius: 12px;
    padding: 6px 10px;
}
  .action-area .qty-control {
    display: none;
}

.action-area.active .add-btn {
    display: none;
}

.action-area.active .qty-control {
    display: flex;
}
  .products-grid {
    display: grid;
    grid-template-columns: 1fr;
    row-gap: 26px;
    padding: 16px;
}
  .sheet-handle {
    width: 40px;
    height: 5px;
    border-radius: 10px;
    background: rgba(255,255,255,0.3);
    margin: 0 auto 10px auto;
}
  /* ===== –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –∫–æ—Ä–∑–∏–Ω—ã ===== */

.cart-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #111;
    padding: 14px 16px;
    display: none;
    z-index: 999;
    box-shadow: 0 -4px 25px rgba(0,0,0,0.5);
}

.cart-bar-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#cartTotal {
    font-size: 18px;
    font-weight: bold;
    color: #fff;
}

.cart-bar button {
    background: #ff3b5c;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 14px;
    font-weight: bold;
    cursor: pointer;
}

</style>
</head>

<body>
  <div id="topBar">
    <div id="cartIcon" onclick="renderCart()">
        üõí <span id="cartCount">0</span>
    </div>
</div>

<div id="main"></div>
<div id="orderSuccess">‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</div>

<!-- üî• –í–°–¢–ê–í–ò–¢–¨ –í–û–¢ –ó–î–ï–°–¨ -->
<div id="cartBar" class="cart-bar">
    <div class="cart-bar-content">
        <span id="cartTotal">0 ‚ÇΩ</span>
        <button onclick="renderCart()">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
</div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
  updateCartBar();
let currentCategory = null;
  const operatorUsername = "budapuff_meneger"; // <-- —Å—é–¥–∞ —Å–≤–æ–π username
  
  const categoryImages = {
  "–ñ–∏–¥–∫–æ—Å—Ç–∏": "icons/–∏–∫–∂–∏–∂.png",
  "POD-—Å–∏—Å—Ç–µ–º—ã": "icons/–ø–æ–¥.png",
  "–°—ä–µ–¥–æ–±–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã": "icons/–µ–¥–∞.png"
};

  const products = {

  "–ñ–∏–¥–∫–æ—Å—Ç–∏": [
    {
      name: "2780",
      price: 400,
      image: "liquids/2780.jpg",
      description: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π –≤–∫—É—Å —Å –º—è–≥–∫–∏–º –ø–æ—Å–ª–µ–≤–∫—É—Å–∏–µ–º. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."
    },
    {
      name: "2786",
      price: 450,
      image: "liquids/2786_1.jpg",
      description: "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å —Å –ø—Ä–∏—è—Ç–Ω—ã–º –∞—Ä–æ–º–∞—Ç–æ–º –∏ –ª—ë–≥–∫–æ–π —Å–ª–∞–¥–æ—Å—Ç—å—é."
    },
    {
      name: "2789",
      price: 450,
      image: "liquids/2789.jpg",
      description: "–Ø—Ä–∫–∏–π –≤–∫—É—Å —Å –ø–ª–æ—Ç–Ω—ã–º –ø–∞—Ä–æ–º –∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–º –∞—Ä–æ–º–∞—Ç–æ–º."
    },
    {
      name: "Dosi Kush",
      price: 500,
      image: "liquids/dosi_kush.jpg",
      description: "–ì–ª—É–±–æ–∫–∏–π –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –≤–∫—É—Å —Å –º—è–≥–∫–æ–π —Å–ª–∞–¥–∫–æ–≤–∞—Ç–æ–π –Ω–æ—Ç–∫–æ–π."
    },
    {
      name: "LCG",
      price: 500,
      image: "liquids/lcg.jpg",
      description: "–û—Å–≤–µ–∂–∞—é—â–∏–π –≤–∫—É—Å —Å –ª—ë–≥–∫–∏–º —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–º –æ—Ç—Ç–µ–Ω–∫–æ–º."
    },
    {
      name: "Mint",
      price: 450,
      image: "liquids/mint.jpg",
      description: "–ß–∏—Å—Ç–∞—è –æ—Å–≤–µ–∂–∞—é—â–∞—è –º—è—Ç–∞ —Å –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º."
    },
    {
      name: "OG Cush",
      price: 500,
      image: "liquids/ogcush.jpg",
      description: "–ü–ª–æ—Ç–Ω—ã–π –≤–∫—É—Å —Å –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º –∞—Ä–æ–º–∞—Ç–æ–º –∏ –º—è–≥–∫–∏–º –ø–∞—Ä–æ–º."
    },
    {
      name: "Original Z",
      price: 500,
      image: "liquids/original_z.jpg",
      description: "–°–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –∞—Ä–æ–º–∞—Ç —Å –ª—ë–≥–∫–æ–π —Ñ—Ä—É–∫—Ç–æ–≤–æ–π –Ω–æ—Ç–∫–æ–π."
    },
    {
      name: "Permanent Marker",
      price: 550,
      image: "liquids/permanent_marker.jpg",
      description: "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –∞—Ä–æ–º–∞—Ç —Å —è—Ä–∫–∏–º –∏ –¥–æ–ª–≥–∏–º –ø–æ—Å–ª–µ–≤–∫—É—Å–∏–µ–º."
    },
    {
      name: "Super Lemon Haze",
      price: 550,
      image: "liquids/super_lemon_haze.jpg",
      description: "–Ø—Ä–∫–∏–π –ª–∏–º–æ–Ω–Ω—ã–π –≤–∫—É—Å —Å –æ—Å–≤–µ–∂–∞—é—â–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º."
    }
  ],

  "POD-—Å–∏—Å—Ç–µ–º—ã": [
    {
      name: "9 Pound Hammer",
      price: 2500,
      image: "pods/9poundhammer.png",
      description: "–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è POD-—Å–∏—Å—Ç–µ–º–∞ —Å –≤—ã—Å–æ–∫–æ–π –º–æ—â–Ω–æ—Å—Ç—å—é –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ç—è–≥–æ–π."
    },
    {
      name: "Big Bad Bear",
      price: 3000,
      image: "pods/bigbadbear.png",
      description: "–ú–æ—â–Ω–∞—è POD-—Å–∏—Å—Ç–µ–º–∞ —Å —É–¥–æ–±–Ω–æ–π –∑–∞–ø—Ä–∞–≤–∫–æ–π –∏ –¥–æ–ª–≥–æ–π —Ä–∞–±–æ—Ç–æ–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞."
    }
  ],

  "–°—ä–µ–¥–æ–±–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã": [
    {
      name: "Browne",
      price: 500,
      image: "food/broune.png",
      description: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —à–æ–∫–æ–ª–∞–¥–Ω—ã–π –≤–∫—É—Å —Å –º—è–≥–∫–æ–π —Ç–µ–∫—Å—Ç—É—Ä–æ–π."
    },
    {
      name: "Cookie",
      price: 450,
      image: "food/cookie.png",
      description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –ø–µ—á–µ–Ω—å–µ —Å –ø—Ä–∏—è—Ç–Ω–æ–π —Å–ª–∞–¥–æ—Å—Ç—å—é."
    },
    {
      name: "THC Cherry",
      price: 550,
      image: "food/thc_cherry.png",
      description: "–°–ª–∞–¥–∫–∞—è –≤–∏—à–Ω—ë–≤–∞—è –Ω–æ—Ç–∫–∞ —Å —è—Ä–∫–∏–º –∞—Ä–æ–º–∞—Ç–æ–º."
    }
]
};

function updateCartBar() {

    const cartBar = document.getElementById("cartBar");
    const cartTotal = document.getElementById("cartTotal");

    const cartIcon = document.getElementById("cartIcon");
    const cartCount = document.getElementById("cartCount");

    if (!cartIcon || !cartCount) return;

    const totalCount = cart.reduce((sum, item) => sum + item.qty, 0);

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É —Å–≤–µ—Ä—Ö—É
    cartCount.textContent = totalCount;

    // –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É
    if (totalCount === 0) {
        cartIcon.style.display = "none";
    } else {
        cartIcon.style.display = "flex";
    }

    // --- –Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å ---
    if (!cartBar || !cartTotal) return;

    if (cart.length === 0) {
        cartBar.style.display = "none";
        return;
    }

    const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);

    cartTotal.textContent = total + " ‚ÇΩ";
    cartBar.style.display = "block";
}
  
function renderCategoryContent(category){
    let html = `<button id="backBtn" onclick="renderCategories()">‚Üê –ù–∞–∑–∞–¥</button>`;
    html += `<h2>${category}</h2><div class="products-grid">`;

    products[category].forEach((item, index) => {
        html += `
        <div class="product-card show"
     id="card-${item.name.replace(/\s/g, "_")}"
            style="animation-delay: ${index * 0.05}s"
            onclick="openProduct('${category}', '${item.name.replace(/'/g, "\\'")}')">

            <img src="${item.image}">

<div class="category-content">
    <div class="category-title">
        ${item.name}
    </div>

    <div class="category-price">
        ${item.price} ‚ÇΩ
    </div>
</div>

           <div class="action-area ${getQty(item.name) > 0 ? "active" : ""}">

    <button class="add-btn"
        onclick="event.stopPropagation(); changeQty('${item.name}', ${item.price}, 1)">
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
    </button>

    <div class="qty-control">

        <button class="qty-btn"
            onclick="event.stopPropagation(); changeQty('${item.name}', ${item.price}, -1)">
            ‚àí
        </button>

        <span class="qty-number"
            id="qty-${item.name.replace(/\s/g, "_")}">
            ${getQty(item.name)} —à—Ç.
        </span>

        <button class="qty-btn"
            onclick="event.stopPropagation(); changeQty('${item.name}', ${item.price}, 1)">
            +
        </button>

    </div>

</div>
        </div>
        `;
    });

    html += `</div>`;
    return html;
}
  
function openCategory(category){
  currentCategory = category;

  const html = renderCategoryContent(category);
  const main = document.getElementById("main");

  main.classList.add("fade-out");

  setTimeout(() => {
    main.innerHTML = `<div class="screen">${html}</div>`;

    const screen = main.querySelector(".screen");

    requestAnimationFrame(() => {
      screen.classList.add("show");
    });
  }, 200);

  main.classList.remove("fade-out");
}
  
function openProduct(category, productName) {

    const product = products[category].find(p => p.name === productName);
    const qty = getQty(product.name);

    let html = `
    <button id="backBtn" onclick="openCategory('${category}')">–ù–∞–∑–∞–¥</button>

    <div class="product-details">
        
    <div class="product-image-box">
        <img src="${product.image}">
    </div>

    <h2>${product.name}</h2>

        <p class="product-desc">
            ${product.description}
        </p>

        <div class="price-box">
    ${product.price} <span>‚ÇΩ</span>
</div>
    `;

    html += `
<div class="bottom-bar">

    ${qty === 0 ? `
        <button class="continue-btn"
            onclick="changeQty('${product.name}', ${product.price}, 1)">
            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
        </button>
    ` : `
        <button class="continue-btn"
            onclick="renderCart()">
            –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>

        <div class="mini-qty">

            <button onclick="changeQty('${product.name}', ${product.price}, -1)">
                ‚àí
            </button>

            <span>
                ${qty} —à—Ç.
            </span>

            <button onclick="changeQty('${product.name}', ${product.price}, 1)">
                +
            </button>

        </div>
    `}
    
</div>
`;

    html += `</div>`;

    const main = document.getElementById("main");

    main.innerHTML = html;
}

function getQty(name){
  const item = cart.find(i => i.name === name);
  return item ? item.qty : 0;
}

function changeQty(name, price, delta) {

    const existing = cart.find(i => i.name === name);

    if (existing) {
    existing.qty += delta;

   if (existing.qty < 1) {

    // –µ—Å–ª–∏ –º—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ ‚Äî –Ω–µ –¥–∞—ë–º —É–π—Ç–∏ –Ω–∏–∂–µ 1
    if (document.querySelector("h2")?.textContent === "–ö–æ—Ä–∑–∏–Ω–∞") {
        existing.qty = 1;
    } 
    // –µ—Å–ª–∏ –º—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî —É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä
    else {
        cart = cart.filter(i => i.name !== name);
    }
}

} else if (delta > 0) {
    cart.push({ name, price, qty: 1 });
}
    localStorage.setItem("cart", JSON.stringify(cart));
updateCartBar();

    // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
    if (document.querySelector(".product-details")) {
        openProduct(currentCategory, name);
    }

    // –µ—Å–ª–∏ –º—ã –≤ —Å–ø–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É
    else if (currentCategory) {

        const safeName = name.replace(/\s/g, "_");
        const card = document.getElementById(`card-${safeName}`);

        if (card) {

            const qty = getQty(name);
          const actionArea = card.querySelector(".action-area");
const qtyEl = document.getElementById(`qty-${safeName}`);

if (actionArea) {
    if (qty > 0) {
        actionArea.classList.add("active");
    } else {
        actionArea.classList.remove("active");
    }
}

if (qtyEl) {
    qtyEl.textContent = qty + " —à—Ç.";

    qtyEl.classList.remove("bump");
    void qtyEl.offsetWidth;
    qtyEl.classList.add("bump");
  
        }
    }
}
     else {
        renderCart();
    }

} 

function removeFromCart(name) {
    cart = cart.filter(item => item.name !== name);
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    updateCartBar();
}
function renderCart(){
  currentCategory = null;
  let html = `<button id="backBtn" onclick="renderCategories()">‚Üê –ù–∞–∑–∞–¥</button>`;
  html += "<h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>";

  if(cart.length === 0){
    html += "<p>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</p>";
  } else {
    let total = 0;
    cart.forEach(item => {
      total += item.price * item.qty;
      html += `
<div class="cart-item">
    <div class="cart-item-info">
        <strong>${item.name}</strong>
        <div class="cart-item-price">
            ${item.price * item.qty} ‚ÇΩ
        </div>
    </div>

    <div class="cart-controls">
        <button onclick="changeQty('${item.name}', ${item.price}, -1)">‚àí</button>
        <span>${item.qty}</span>
        <button onclick="changeQty('${item.name}', ${item.price}, 1)">+</button>
        <button class="remove-btn" onclick="removeFromCart('${item.name}')">‚úï</button>
    </div>
</div>
`;
    });
    html += `
<div class="cart-summary">

    <div class="sheet-handle"></div>

    <div class="summary-row">
        <span class="summary-label">–ò—Ç–æ–≥–æ</span>
        <span class="summary-price">${total} ‚ÇΩ</span>
    </div>

    <button class="summary-btn" onclick="sendOrder()">
        –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
    </button>

</div>
`;
  }

  document.getElementById("main").innerHTML = html;
}

async function sendOrder() {
    if (cart.length === 0) return;

    const tg = window.Telegram?.WebApp;
    const user = tg?.initDataUnsafe?.user;

    let text = "üÜï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑\n\nüì¶ –¢–æ–≤–∞—Ä—ã:\n";
    let total = 0;

    cart.forEach(item => {
        text += `‚Ä¢ ${item.name} x ${item.qty} ‚Äî ${item.price * item.qty} ‚ÇΩ\n`;
        total += item.price * item.qty;
    });

text += `\nüí∞ –ò—Ç–æ–≥–æ: ${total} ‚ÇΩ\n\n`;
text += `üë§ –ö–ª–∏–µ–Ω—Ç:\n`;
text += `Username: @${user?.username || "–Ω–µ —É–∫–∞–∑–∞–Ω"}\n`;
text += `üÜî ID: ${user?.id}`;

    const response = await fetch("/api/send-order", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            orderText: text,
            userId: user?.id
        })
    });

    if (response.ok) {
        cart = [];
        updateCartBar();
        showSuccessMessage();
    } else {
        alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞");
    }
}
  function showSuccessMessage() {
    const success = document.getElementById("orderSuccess");
    if (!success) return;

    success.classList.add("show");

    setTimeout(() => {
        success.classList.remove("show");
        renderCategories();
    }, 2000);
}
  function renderCategories() {

    let html = `
    <div class="top-menu">
        <button class="active" onclick="renderCategories()">üõç –ö–∞—Ç–∞–ª–æ–≥</button>
        <button onclick="renderDelivery()">üöö –î–æ—Å—Ç–∞–≤–∫–∞</button>
        <button onclick="renderPayment()">üí≥ –û–ø–ª–∞—Ç–∞</button>
    </div>

    <h2 class="section-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div class="grid">
    `;

    for (let category in products) {
        html += `
        <div class="category-card"
            style="background-image: url('${categoryImages[category]}')"
            onclick="openCategory('${category}')">
            ${category}
        </div>
        `;
    }

    html += `</div>`;

    document.getElementById("main").innerHTML = html;
}

  function renderDelivery() {
    let html = `
   <div class="top-menu">
    <button onclick="renderCategories()">üõç –ö–∞—Ç–∞–ª–æ–≥</button>
    <button class="active" onclick="renderDelivery()">üöö –î–æ—Å—Ç–∞–≤–∫–∞</button>
    <button onclick="renderPayment()">üí≥ –û–ø–ª–∞—Ç–∞</button>
</div>

    <h2>üöö –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏</h2>

    <div class="cards-grid">

        <div class="delivery-card highlight">
            <h3>üöÄ –ö—É—Ä—å–µ—Ä –ø–æ –ú–æ—Å–∫–≤–µ</h3>
            <p>‚úî –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –¥–µ–Ω—å –∑–∞–∫–∞–∑–∞</p>
            <p>‚úî –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</p>
            <p>‚úî –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</p>
            <div class="badge">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</div>
        </div>

        <div class="delivery-card">
            <h3>üì¶ –°–î–≠–ö</h3>
            <p>‚úî –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</p>
            <p>‚úî –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</p>
            <p>‚úî –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –†–§</p>
        </div>

        <div class="delivery-card">
            <h3>üìÆ –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</h3>
            <p>‚úî 1 –∫–ª–∞—Å—Å</p>
            <p>‚úî –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</p>
            <p>‚úî –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –†–§</p>
        </div>

        <div class="delivery-card">
            <h3>üü° –Ø–Ω–¥–µ–∫—Å.–î–æ—Å—Ç–∞–≤–∫–∞</h3>
            <p>‚úî –ü–í–ó</p>
            <p>‚úî –ö—É—Ä—å–µ—Ä</p>
            <p>‚úî –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</p>
        </div>

    </div>
    `;

    document.getElementById("main").innerHTML = html;
}

function renderPayment() {
    let html = `
    <div class="top-menu">
    <button onclick="renderCategories()">üõç –ö–∞—Ç–∞–ª–æ–≥</button>
    <button onclick="renderDelivery()">üöö –î–æ—Å—Ç–∞–≤–∫–∞</button>
    <button class="active" onclick="renderPayment()">üí≥ –û–ø–ª–∞—Ç–∞</button>
</div>

    <h2>üí≥ –í–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã</h2>

    <div class="cards-grid">

        <div class="payment-card highlight">
            <h3>üíµ –ù–∞–ª–∏—á–Ω—ã–µ</h3>
            <p>‚úî –û–ø–ª–∞—Ç–∞ –∫—É—Ä—å–µ—Ä—É</p>
            <p>‚úî –ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏</p>
            <div class="badge">–£–¥–æ–±–Ω–æ</div>
        </div>

        <div class="payment-card">
            <h3>‚Çø Bitcoin</h3>
            <p>‚úî 0% –∫–æ–º–∏—Å—Å–∏—è</p>
            <p>‚úî –ê–Ω–æ–Ω–∏–º–Ω–æ</p>
        </div>

        <div class="payment-card">
            <h3>üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</h3>
            <p>‚úî –ë—ã—Å—Ç—Ä–æ</p>
            <p>‚úî –ë–µ–∑–æ–ø–∞—Å–Ω–æ</p>
        </div>

        <div class="payment-card">
            <h3>üí≤ USDT</h3>
            <p>‚úî 0% –∫–æ–º–∏—Å—Å–∏—è</p>
            <p>‚úî –ê–Ω–æ–Ω–∏–º–Ω–æ</p>
        </div>

    </div>
    `;

    document.getElementById("main").innerHTML = html;
}

updateCartBar();

renderCategories();   
updateCartBar();      

</script>
</body>
</html>
